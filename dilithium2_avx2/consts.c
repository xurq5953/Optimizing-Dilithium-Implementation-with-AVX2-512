#include "consts.h"
#include "params.h"
#include <stdint.h>

#define QINV 58728449 // q^(-1) mod 2^32
#define MONT (-4186625) // 2^32 mod q
#define DIV 41978 // mont^2/256
#define DIV_QINV (-8395782)

const qdata_t DILITHIUM2_AVX2_qdata = {{
#define _8XQ 0
                                                       Q, Q, Q, Q, Q, Q, Q, Q,

#define _8XQINV 8
                                                       QINV, QINV, QINV, QINV, QINV, QINV, QINV, QINV,

#define _8XDIV_QINV 16
                                                       DIV_QINV, DIV_QINV, DIV_QINV, DIV_QINV, DIV_QINV, DIV_QINV,
                                                       DIV_QINV, DIV_QINV,

#define _8XDIV 24
                                                       DIV, DIV, DIV, DIV, DIV, DIV, DIV, DIV,

#define _ZETAS_QINV 32
                                                       -151046689, 1830765815, -1929875198, -1927777021, 1640767044,
                                                       1477910808, 1612161320, 1640734244,
                                                       308362795, 308362795, 308362795, 308362795, -1815525077,
                                                       -1815525077, -1815525077, -1815525077,
                                                       -1374673747, -1374673747, -1374673747, -1374673747, -1091570561,
                                                       -1091570561, -1091570561, -1091570561,
                                                       -1929495947, -1929495947, -1929495947, -1929495947, 515185417,
                                                       515185417, 515185417, 515185417,
                                                       -285697463, -285697463, -285697463, -285697463, 625853735,
                                                       625853735, 625853735, 625853735,
                                                       1727305304, 1727305304, 2082316400, 2082316400, -1364982364,
                                                       -1364982364, 858240904, 858240904,
                                                       1806278032, 1806278032, 222489248, 222489248, -346752664,
                                                       -346752664, 684667771, 684667771,
                                                       1654287830, 1654287830, -878576921, -878576921, -1257667337,
                                                       -1257667337, -748618600, -748618600,
                                                       329347125, 329347125, 1837364258, 1837364258, -1443016191,
                                                       -1443016191, -1170414139, -1170414139,
                                                       -1846138265, -1631226336, -1404529459, 1838055109, 1594295555,
                                                       -1076973524, -1898723372, -594436433,
                                                       -202001019, -475984260, -561427818, 1797021249, -1061813248,
                                                       2059733581, -1661512036, -1104976547,
                                                       -1750224323, -901666090, 418987550, 1831915353, -1925356481,
                                                       992097815, 879957084, 2024403852,
                                                       1484874664, -1636082790, -285388938, -1983539117, -1495136972,
                                                       -950076368, -1714807468, -952438995,

                                                       -1574918427, 1350681039, -2143979939, 1599739335, -1285853323,
                                                       -993005454, -1440787840, 568627424,
                                                       -783134478, -588790216, 289871779, -1262003603, 2135294594,
                                                       -1018755525, -889861155, 1665705315,
                                                       1321868265, 1225434135, -1784632064, 666258756, 675310538,
                                                       -1555941048, -1999506068, -1499481951,
                                                       -695180180, -1375177022, 1777179795, 334803717, -178766299,
                                                       -518252220, 1957047970, 1146323031,
                                                       -654783359, -1974159335, 1651689966, 140455867, -1039411342,
                                                       1955560694, 1529189038, -2131021878,
                                                       -247357819, 1518161567, -86965173, 1708872713, 1787797779,
                                                       1638590967, -120646188, -1669960606,
                                                       -916321552, 1155548552, 2143745726, 1210558298, -1261461890,
                                                       -318346816, 628664287, -1729304568,
                                                       1422575624, 1424130038, -1185330464, 235321234, 168022240,
                                                       1206536194, 985155484, -894060583,
                                                       -898413, -1363460238, -605900043, 2027833504, 14253662,
                                                       1014493059, 863641633, 1819892093,
                                                       2124962073, -1223601433, -1920467227, -1637785316, -1536588520,
                                                       694382729, 235104446, -1045062172,
                                                       831969619, -300448763, 756955444, -260312805, 1554794072,
                                                       1339088280, -2040058690, -853476187,
                                                       -2047270596, -1723816713, -1591599803, -440824168, 1119856484,
                                                       1544891539, 155290192, -973777462,
                                                       991903578, 912367099, -44694137, 1176904444, -421552614,
                                                       -818371958, 1747917558, -325927722,
                                                       908452108, 1851023419, -1176751719, -1354528380, -72690498,
                                                       -314284737, 985022747, 963438279,
                                                       -1078959975, 604552167, -1021949428, 608791570, 173440395,
                                                       -2126092136, -1316619236, -1039370342,
                                                       6087993, -110126092, 565464272, -1758099917, -1600929361,
                                                       879867909, -1809756372, 400711272,
                                                       1363007700, 30313375, -326425360, 1683520342, -517299994,
                                                       2027935492, -1372618620, 128353682,
                                                       -1123881663, 137583815, -635454918, -642772911, 45766801,
                                                       671509323, -2070602178, 419615363,
                                                       1216882040, -270590488, -1276805128, 371462360, -1357098057,
                                                       -384158533, 827959816, -596344473,
                                                       702390549, -279505433, -260424530, -71875110, -1208667171,
                                                       -1499603926, 2036925262, -540420426,
                                                       746144248, -1420958686, 2032221021, 1904936414, 1257750362,
                                                       1926727420, 1931587462, 1258381762,
                                                       885133339, 1629985060, 1967222129, 6363718, -1287922800,
                                                       1136965286, 1779436847, 1116720494,
                                                       1042326957, 1405999311, 713994583, 940195359, -1542497137,
                                                       2061661095, -883155599, 1726753853,
                                                       -1547952704, 394851342, 283780712, 776003547, 1123958025,
                                                       201262505, 1934038751, 374860238,

//#define _ZETAS 328
                                                       -3975713, 25847, -2608894, -518909, 237124, -777960, -876248,
                                                       466468,
                                                       1826347, 1826347, 1826347, 1826347, 2353451, 2353451, 2353451,
                                                       2353451,
                                                       -359251, -359251, -359251, -359251, -2091905, -2091905, -2091905,
                                                       -2091905,
                                                       3119733, 3119733, 3119733, 3119733, -2884855, -2884855, -2884855,
                                                       -2884855,
                                                       3111497, 3111497, 3111497, 3111497, 2680103, 2680103, 2680103,
                                                       2680103,
                                                       2725464, 2725464, 1024112, 1024112, -1079900, -1079900, 3585928,
                                                       3585928,
                                                       -549488, -549488, -1119584, -1119584, 2619752, 2619752, -2108549,
                                                       -2108549,
                                                       -2118186, -2118186, -3859737, -3859737, -1399561, -1399561,
                                                       -3277672, -3277672,
                                                       1757237, 1757237, -19422, -19422, 4010497, 4010497, 280005,
                                                       280005,
                                                       2706023, 95776, 3077325, 3530437, -1661693, -3592148, -2537516,
                                                       3915439,
                                                       -3861115, -3043716, 3574422, -2867647, 3539968, -300467, 2348700,
                                                       -539299,
                                                       -1699267, -1643818, 3505694, -3821735, 3507263, -2140649,
                                                       -1600420, 3699596,
                                                       811944, 531354, 954230, 3881043, 3900724, -2556880, 2071892,
                                                       -2797779,

                                                       -3930395, -3677745, -1452451, 2176455, -1257611, -4083598,
                                                       -3190144, -3632928,
                                                       3412210, 2147896, -2967645, -411027, -671102, -22981, -381987,
                                                       1852771,
                                                       -3343383, 508951, 44288, 904516, -3724342, 1653064, 2389356,
                                                       759969,
                                                       189548, 3159746, -2409325, 1315589, 1285669, -812732, -3019102,
                                                       -3628969,
                                                       -1528703, -3041255, 3475950, -1585221, 1939314, -1000202,
                                                       -3157330, 126922,
                                                       -983419, 2715295, -3693493, -2477047, -1228525, -1308169,
                                                       1349076, -1430430,
                                                       264944, 3097992, -1100098, 3958618, -8578, -3249728, -210977,
                                                       -1316856,
                                                       -3553272, -1851402, -177440, 1341330, -1584928, -1439742,
                                                       -3881060, 3839961,
                                                       2091667, -3342478, 266997, -3520352, 900702, 495491, -655327,
                                                       -3556995,
                                                       342297, 3437287, 2842341, 4055324, -3767016, -2994039, -1333058,
                                                       -451100,
                                                       -1279661, 1500165, -542412, -2584293, -2013608, 1957272,
                                                       -3183426, 810149,
                                                       -3038916, 2213111, -426683, -1667432, -2939036, 183443, -554416,
                                                       3937738,
                                                       3407706, 2244091, 2434439, -3759364, 1859098, -1613174, -3122442,
                                                       -525098,
                                                       286988, -3342277, 2691481, 1247620, 1250494, 1869119, 1237275,
                                                       1312455,
                                                       1917081, 777191, -2831860, -3724270, 2432395, 3369112, 162844,
                                                       1652634,
                                                       3523897, -975884, 1723600, -1104333, -2235985, -976891, 3919660,
                                                       1400424,
                                                       2316500, -2446433, -1235728, -1197226, 909542, -43260, 2031748,
                                                       -768622,
                                                       -2437823, 1735879, -2590150, 2486353, 2635921, 1903435, -3318210,
                                                       3306115,
                                                       -2546312, 2235880, -1671176, 594136, 2454455, 185531, 1616392,
                                                       -3694233,
                                                       3866901, 1717735, -1803090, -260646, -420899, 1612842, -48306,
                                                       -846154,
                                                       3817976, -3562462, 3513181, -3193378, 819034, -522500, 3207046,
                                                       -3595838,
                                                       4108315, 203044, 1265009, 1595974, -3548272, -1050970, -1430225,
                                                       -1962642,
                                                       -1374803, 3406031, -1846953, -3776993, -164721, -1207385,
                                                       3014001, -1799107,
                                                       269760, 472078, 1910376, -3833893, -2286327, -3545687, -1362209,
                                                       1976782,
                                               }
};



__attribute__((aligned(32)))
const int32_t inte_qdata[512] = {
#define ZETA 0
        //level 5
        2706023, -1846138265, 2706023, -1846138265, 95776, -1631226336, 95776, -1631226336,
        3077325, -1404529459, 3077325, -1404529459, 3530437, 1838055109, 3530437, 1838055109,
        -1661693, 1594295555, -1661693, 1594295555, -3592148, -1076973524, -3592148, -1076973524,
        -2537516, -1898723372, -2537516, -1898723372, 3915439, -594436433, 3915439, -594436433,
        -3861115, -202001019, -3861115, -202001019, -3043716, -475984260, -3043716, -475984260,
        3574422, -561427818, 3574422, -561427818, -2867647, 1797021249, -2867647, 1797021249,
        3539968, -1061813248, 3539968, -1061813248, -300467, 2059733581, -300467, 2059733581,
        2348700, -1661512036, 2348700, -1661512036, -539299, -1104976547, -539299, -1104976547,
        -1699267, -1750224323, -1699267, -1750224323, -1643818, -901666090, -1643818, -901666090,
        3505694, 418987550, 3505694, 418987550, -3821735, 1831915353, -3821735, 1831915353,
        3507263, -1925356481, 3507263, -1925356481, -2140649, 992097815, -2140649, 992097815,
        -1600420, 879957084, -1600420, 879957084, 3699596, 2024403852, 3699596, 2024403852,
        811944, 1484874664, 811944, 1484874664, 531354, -1636082790, 531354, -1636082790,
        954230, -285388938, 954230, -285388938, 3881043, -1983539117, 3881043, -1983539117,
        3900724, -1495136972, 3900724, -1495136972, -2556880, -950076368, -2556880, -950076368,
        2071892, -1714807468, 2071892, -1714807468, -2797779, -952438995, -2797779, -952438995,

        //level 6
        -3930395, -1574918427, -1528703, -654783359, -3677745, 1350681039, -3041255,
        -1974159335, -1452451, -2143979939, 3475950, 1651689966, 2176455, 1599739335,
        -1585221, 140455867, -1257611, -1285853323, 1939314, -1039411342, -4083598,
        -993005454, -1000202, 1955560694, -3190144, -1440787840, -3157330, 1529189038,
        -3632928, 568627424, 126922, -2131021878, 3412210, -783134478, -983419, -247357819,
        2147896, -588790216, 2715295, 1518161567, -2967645, 289871779, -3693493, -86965173,
        -411027, -1262003603, -2477047, 1708872713, -671102, 2135294594, -1228525, 1787797779,
        -22981, -1018755525, -1308169, 1638590967, -381987, -889861155, 1349076, -120646188,
        1852771, 1665705315, -1430430, -1669960606, -3343383, 1321868265, 264944, -916321552,
        508951, 1225434135, 3097992, 1155548552, 44288, -1784632064, -1100098, 2143745726,
        904516, 666258756, 3958618, 1210558298, -3724342, 675310538, -8578, -1261461890,
        1653064, -1555941048, -3249728, -318346816, 2389356, -1999506068, -210977, 628664287,
        759969, -1499481951, -1316856, -1729304568, 189548, -695180180, -3553272, 1422575624,
        3159746, -1375177022, -1851402, 1424130038, -2409325, 1777179795, -177440, -1185330464,
        1315589, 334803717, 1341330, 235321234, 1285669, -178766299, -1584928, 168022240,
        -812732, -518252220, -1439742, 1206536194, -3019102, 1957047970, -3881060, 985155484,
        -3628969, 1146323031, 3839961, -894060583,



        //level 7 zeta

        2091667, 3407706, 2316500, 3817976, -3342478, 2244091, -2446433, -3562462,
        266997, 2434439, -1235728, 3513181, -3520352, -3759364, -1197226, -3193378,
        900702, 1859098, 909542, 819034, 495491, -1613174, -43260, -522500,
        -655327, -3122442, 2031748, 3207046, -3556995, -525098, -768622, -3595838,
        342297, 286988, -2437823, 4108315, 3437287, -3342277, 1735879, 203044,
        2842341, 2691481, -2590150, 1265009, 4055324, 1247620, 2486353, 1595974,
        -3767016, 1250494, 2635921, -3548272, -2994039, 1869119, 1903435, -1050970,
        -1333058, 1237275, -3318210, -1430225, -451100, 1312455, 3306115, -1962642,
        -1279661, 1917081, -2546312, -1374803, 1500165, 777191, 2235880, 3406031,
        -542412, -2831860, -1671176, -1846953, -2584293, -3724270, 594136, -3776993,
        -2013608, 2432395, 2454455, -164721, 1957272, 3369112, 185531, -1207385,
        -3183426, 162844, 1616392, 3014001, 810149, 1652634, -3694233, -1799107,
        -3038916, 3523897, 3866901, 269760, 2213111, -975884, 1717735, 472078,
        -426683, 1723600, -1803090, 1910376, -1667432, -1104333, -260646, -3833893,
        -2939036, -2235985, -420899, -2286327, 183443, -976891, 1612842, -3545687,
        -554416, 3919660, -48306, -1362209, 3937738, 1400424, -846154, 1976782,

//level 7 zinvq

        -898413, 991903578, 1363007700, 746144248, -1363460238, 912367099, 30313375, -1420958686,
        -605900043, -44694137, -326425360, 2032221021, 2027833504, 1176904444, 1683520342, 1904936414,
        14253662, -421552614, -517299994, 1257750362, 1014493059, -818371958, 2027935492, 1926727420,
        863641633, 1747917558, -1372618620, 1931587462, 1819892093, -325927722, 128353682, 1258381762,
        2124962073, 908452108, -1123881663, 885133339, -1223601433, 1851023419, 137583815, 1629985060,
        -1920467227, -1176751719, -635454918, 1967222129, -1637785316, -1354528380, -642772911, 6363718,
        -1536588520, -72690498, 45766801, -1287922800, 694382729, -314284737, 671509323, 1136965286,
        235104446, 985022747, -2070602178, 1779436847, -1045062172, 963438279, 419615363, 1116720494,
        831969619, -1078959975, 1216882040, 1042326957, -300448763, 604552167, -270590488, 1405999311,
        756955444, -1021949428, -1276805128, 713994583, -260312805, 608791570, 371462360, 940195359,
        1554794072, 173440395, -1357098057, -1542497137, 1339088280, -2126092136, -384158533, 2061661095,
        -2040058690, -1316619236, 827959816, -883155599, -853476187, -1039370342, -596344473, 1726753853,
        -2047270596, 6087993, 702390549, -1547952704, -1723816713, -110126092, -279505433, 394851342,
        -1591599803, 565464272, -260424530, 283780712, -440824168, -1758099917, -71875110, 776003547,
        1119856484, -1600929361, -1208667171, 1123958025, 1544891539, 879867909, -1499603926, 201262505,
        155290192, -1809756372, 2036925262, 1934038751, -973777462, 400711272, -540420426, 374860238,

};

__attribute__((aligned(32)))
const int32_t inv_qdata[512] = {
//level 0 zeta
        -1976782, 846154, -1400424, -3937738, 1362209, 48306, -3919660, 554416, 3545687, -1612842, 976891, -183443,
        2286327, 420899, 2235985, 2939036, 3833893, 260646, 1104333, 1667432, -1910376, 1803090, -1723600, 426683,
        -472078, -1717735, 975884, -2213111, -269760, -3866901, -3523897, 3038916, 1799107, 3694233, -1652634, -810149,
        -3014001, -1616392, -162844, 3183426, 1207385, -185531, -3369112, -1957272, 164721, -2454455, -2432395, 2013608,
        3776993, -594136, 3724270, 2584293, 1846953, 1671176, 2831860, 542412, -3406031, -2235880, -777191, -1500165,
        1374803, 2546312, -1917081, 1279661, 1962642, -3306115, -1312455, 451100, 1430225, 3318210, -1237275, 1333058,
        1050970, -1903435, -1869119, 2994039, 3548272, -2635921, -1250494, 3767016, -1595974, -2486353, -1247620,
        -4055324, -1265009, 2590150, -2691481, -2842341, -203044, -1735879, 3342277, -3437287, -4108315, 2437823,
        -286988, -342297, 3595838, 768622, 525098, 3556995, -3207046, -2031748, 3122442, 655327, 522500, 43260, 1613174,
        -495491, -819034, -909542, -1859098, -900702, 3193378, 1197226, 3759364, 3520352, -3513181, 1235728, -2434439,
        -266997, 3562462, 2446433, -2244091, 3342478, -3817976, -2316500, -3407706, -2091667,

//level 0 zinvq
        -374860238, 540420426, -400711272, 973777462, -1934038751, -2036925262, 1809756372, -155290192, -201262505,
        1499603926, -879867909, -1544891539, -1123958025, 1208667171, 1600929361, -1119856484, -776003547, 71875110,
        1758099917, 440824168, -283780712, 260424530, -565464272, 1591599803, -394851342, 279505433, 110126092,
        1723816713, 1547952704, -702390549, -6087993, 2047270596, -1726753853, 596344473, 1039370342, 853476187,
        883155599, -827959816, 1316619236, 2040058690, -2061661095, 384158533, 2126092136, -1339088280, 1542497137,
        1357098057, -173440395, -1554794072, -940195359, -371462360, -608791570, 260312805, -713994583, 1276805128,
        1021949428, -756955444, -1405999311, 270590488, -604552167, 300448763, -1042326957, -1216882040, 1078959975,
        -831969619, -1116720494, -419615363, -963438279, 1045062172, -1779436847, 2070602178, -985022747, -235104446,
        -1136965286, -671509323, 314284737, -694382729, 1287922800, -45766801, 72690498, 1536588520, -6363718,
        642772911, 1354528380, 1637785316, -1967222129, 635454918, 1176751719, 1920467227, -1629985060, -137583815,
        -1851023419, 1223601433, -885133339, 1123881663, -908452108, -2124962073, -1258381762, -128353682, 325927722,
        -1819892093, -1931587462, 1372618620, -1747917558, -863641633, -1926727420, -2027935492, 818371958, -1014493059,
        -1257750362, 517299994, 421552614, -14253662, -1904936414, -1683520342, -1176904444, -2027833504, -2032221021,
        326425360, 44694137, 605900043, 1420958686, -30313375, -912367099, 1363460238, -746144248, -1363007700,
        -991903578, 898413,

//level 1
        -3839961, 894060583, 3628969, -1146323031, 3881060, -985155484, 3019102, -1957047970, 1439742, -1206536194,
        812732, 518252220, 1584928, -168022240, -1285669, 178766299, -1341330, -235321234, -1315589, -334803717, 177440,
        1185330464, 2409325, -1777179795, 1851402, -1424130038, -3159746, 1375177022, 3553272, -1422575624, -189548,
        695180180, 1316856, 1729304568, -759969, 1499481951, 210977, -628664287, -2389356, 1999506068, 3249728,
        318346816, -1653064, 1555941048, 8578, 1261461890, 3724342, -675310538, -3958618, -1210558298, -904516,
        -666258756, 1100098, -2143745726, -44288, 1784632064, -3097992, -1155548552, -508951, -1225434135, -264944,
        916321552, 3343383, -1321868265, 1430430, 1669960606, -1852771, -1665705315, -1349076, 120646188, 381987,
        889861155, 1308169, -1638590967, 22981, 1018755525, 1228525, -1787797779, 671102, -2135294594, 2477047,
        -1708872713, 411027, 1262003603, 3693493, 86965173, 2967645, -289871779, -2715295, -1518161567, -2147896,
        588790216, 983419, 247357819, -3412210, 783134478, -126922, 2131021878, 3632928, -568627424, 3157330,
        -1529189038, 3190144, 1440787840, 1000202, -1955560694, 4083598, 993005454, -1939314, 1039411342, 1257611,
        1285853323, 1585221, -140455867, -2176455, -1599739335, -3475950, -1651689966, 1452451, 2143979939, 3041255,
        1974159335, 3677745, -1350681039, 1528703, 654783359, 3930395, 1574918427,

//level 2
        2797779, 952438995, 2797779, 952438995, -2071892, 1714807468, -2071892, 1714807468, 2556880, 950076368, 2556880,
        950076368, -3900724, 1495136972, -3900724, 1495136972, -3881043, 1983539117, -3881043, 1983539117, -954230,
        285388938, -954230, 285388938, -531354, 1636082790, -531354, 1636082790, -811944, -1484874664, -811944,
        -1484874664, -3699596, -2024403852, -3699596, -2024403852, 1600420, -879957084, 1600420, -879957084, 2140649,
        -992097815, 2140649, -992097815, -3507263, 1925356481, -3507263, 1925356481, 3821735, -1831915353, 3821735,
        -1831915353, -3505694, -418987550, -3505694, -418987550, 1643818, 901666090, 1643818, 901666090, 1699267,
        1750224323, 1699267, 1750224323, 539299, 1104976547, 539299, 1104976547, -2348700, 1661512036, -2348700,
        1661512036, 300467, -2059733581, 300467, -2059733581, -3539968, 1061813248, -3539968, 1061813248, 2867647,
        -1797021249, 2867647, -1797021249, -3574422, 561427818, -3574422, 561427818, 3043716, 475984260, 3043716,
        475984260, 3861115, 202001019, 3861115, 202001019, -3915439, 594436433, -3915439, 594436433, 2537516,
        1898723372, 2537516, 1898723372, 3592148, 1076973524, 3592148, 1076973524, 1661693, -1594295555, 1661693,
        -1594295555, -3530437, -1838055109, -3530437, -1838055109, -3077325, 1404529459, -3077325, 1404529459, -95776,
        1631226336, -95776, 1631226336, -2706023, 1846138265, -2706023, 1846138265,

};

__attribute__((aligned(32)))
const int64_t inte_data2[32] = {0x45c31a3bfffbba3b, 0x5602adffffc2cdff, 0x927c0bde00004bde, 0xec5e8fcbffe52fcb,
                           -2688021319612163367, 1227061264427025847,
                           -7046899915112783396,
                           0x2c9f036800320368,0x4af67b0900155b09, 0x345e0519003ae519, 0x9d65922a0020522a,
                           0xe14ae4f7002c04f7,0x7301c58bffd0658b,
                           0x9fe85ed8000d5ed8,
                           0xd730cc8500202c85, 0x14ab0698ffd80698,0xf2bd156000111560, 0x9456627000086270,
                           0x41100b81001feb81, 0x51efdb5300057b53,
                           0xa7e8dee8000bdee8,
                           0xccd84878ffc94878, 0x515bfa5c00107a5c, 0x83e25f90fff05f90,0x990b69a8ffd669a8,
                           0x6c36b6d5ffdc16d5, 0xed9ec1d5ffe421d5,
                           0x9e33e1bcfffc61bc,
                           0x72e78afd0007eafd, 0x73078efe0027cefe, 0x900ca21003caa21};